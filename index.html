<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXA Sovereign OS v6.0 | Forensic Shield</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Noto+Sans+Arabic:wght@400;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --nexa-blue: #00f2ff; --nexa-green: #00ff88; --nexa-red: #ff0055;
            --nexa-gold: #ffcc00; --panel-bg: #050a14;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            background: #020617; color: #fff; font-family: 'Noto Sans Arabic', sans-serif;
            display: grid; grid-template-columns: 350px 1fr; height: 100vh; overflow: hidden;
        }

        /* --- Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠÙ…Ù†: Ø§Ù„Ø±Ø§Ø¯Ø§Ø± ÙˆØ§Ù„ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ --- */
        .forensic-aside {
            background: var(--panel-bg); border-left: 1px solid #1e293b;
            padding: 20px; display: flex; flex-direction: column; gap: 20px;
        }

        .radar-box {
            width: 200px; height: 200px; margin: 0 auto; border: 2px solid var(--nexa-blue);
            border-radius: 50%; position: relative; overflow: hidden; background: #000;
        }
        .radar-sweep {
            position: absolute; width: 100%; height: 100%; top: 0; left: 0;
            background: conic-gradient(from 0deg, transparent, rgba(0, 242, 255, 0.4));
            animation: rotate 2s linear infinite;
        }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .forensic-report {
            flex: 1; background: #000; border: 1px solid var(--nexa-red); border-radius: 10px;
            padding: 15px; font-family: monospace; font-size: 0.75rem; color: var(--nexa-red);
            overflow-y: auto;
        }

        /* --- Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠØ³Ø±: Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®ØªÙ… ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª --- */
        .main-workspace {
            padding: 30px; display: grid; grid-template-rows: auto 1fr auto; gap: 20px; overflow-y: auto;
        }

        .action-header {
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(255,255,255,0.02); padding: 20px; border-radius: 15px;
        }

        .btn {
            padding: 12px 25px; border-radius: 8px; border: none; font-weight: 800; cursor: pointer;
            font-family: 'Orbitron'; transition: 0.3s;
        }
        .btn-seal { background: var(--nexa-green); color: #000; }
        .btn-radar { background: transparent; border: 1px solid var(--nexa-red); color: var(--nexa-red); }

        /* --- Ù‚Ø³Ù… ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø®ØªÙ… (Ø§Ù„Ø£Ø®Ø¶Ø±) --- */
        .seal-report-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;
        }
        .report-card {
            background: rgba(0, 255, 136, 0.05); border: 1px solid var(--nexa-green);
            padding: 15px; border-radius: 10px; color: var(--nexa-green);
        }

        /* --- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª --- */
        .data-table {
            width: 100%; border-collapse: collapse; background: rgba(255,255,255,0.02);
            border-radius: 10px; overflow: hidden;
        }
        .data-table th { background: #1e293b; padding: 12px; text-align: right; color: var(--nexa-blue); }
        .data-table td { padding: 12px; border-bottom: 1px solid #1e293b; font-size: 0.8rem; }

        .status-badge { padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 0.7rem; }
        .status-saved { background: var(--nexa-gold); color: #000; } /* Ù…Ø­ÙÙˆØ¸ Ù…Ø³Ø¨Ù‚Ø§Ù‹ */
        .status-alert { background: var(--nexa-red); color: #fff; } /* Ù…ØªÙ„Ø§Ø¹Ø¨ Ø¨Ù‡ */

        /* Ø§Ù„Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¯Ø§Ø®Ù„ */
        @media (max-width: 1000px) {
            body { grid-template-columns: 1fr; overflow-y: auto; }
            .forensic-aside { height: auto; }
        }
    </style>
</head>
<body>

    <aside class="forensic-aside">
        <h3 style="font-family:'Orbitron'; text-align:center; color:var(--nexa-red);">RADAR FORENSICS</h3>
        <div class="radar-box">
            <div class="radar-sweep" id="radar"></div>
            <i class="fas fa-search-nodes" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); color:var(--nexa-red);"></i>
        </div>
        
        <div class="forensic-report" id="forensicLog">
            > [RADAR] Ù†Ø¸Ø§Ù… ÙƒØ´Ù Ø§Ù„ØªÙ„Ø§Ø¹Ø¨ Ù†Ø´Ø·...<br>
            > Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø³Ø­ Ø§Ù„Ø¬Ø²ÙŠØ¦Ø§Øª...
        </div>
        
        <button class="btn btn-radar" onclick="runRadarCheck()">
            <i class="fas fa-virus-slash"></i> ÙØ­Øµ ØªÙ„Ø§Ø¹Ø¨ Ø§Ù„Ù…Ù†ØµØ§Øª
        </button>
    </aside>

    <main class="main-workspace">
        <div class="action-header">
            <div>
                <h2 style="font-family:'Orbitron'; color:var(--nexa-blue);">NEXA SOVEREIGN SEAL</h2>
                <p id="walletInfo" style="font-size:0.7rem; color:#64748b;">Ø§Ù„Ù…Ø­ÙØ¸Ø©: ØºÙŠØ± Ù…Ø±ØªØ¨Ø·Ø©</p>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="btn" style="background:#f6851b; color:#fff;" onclick="connectWallet()">Ø±Ø¨Ø· MetaMask</button>
                <button class="btn btn-seal" onclick="document.getElementById('fileInp').click()">Ø±ÙØ¹ ÙˆØ®ØªÙ… Ø¬Ø²ÙŠØ¦ÙŠ</button>
            </div>
        </div>

        <input type="file" id="fileInp" hidden multiple onchange="processNexaFiles(this)">

        <div class="seal-report-grid" id="sealReports">
            </div>

        <div style="overflow-x:auto;">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Ø§Ù„Ù…Ø­ØªÙˆÙ‰</th>
                        <th>Ø§Ù„Ø¨ØµÙ…Ø© Ø§Ù„Ø¬Ø²ÙŠØ¦ÙŠØ©</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ù†Ø¸Ø§Ù… nxa</th>
                        <th>ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ­Ù‚ÙŠÙ‚</th>
                    </tr>
                </thead>
                <tbody id="registryTable">
                    </tbody>
            </table>
        </div>
    </main>

<script>
let wallet = null, registry = [];

async function connectWallet() {
    if (!window.ethereum) return alert("MetaMask required");
    const p = new ethers.providers.Web3Provider(window.ethereum);
    const acc = await p.send("eth_requestAccounts", []);
    wallet = acc[0];
    document.getElementById('walletInfo').innerText = "Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø³ÙŠØ§Ø¯ÙŠØ©: " + wallet;
    logSeal("âœ… ØªÙ… Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ MetaMask ÙˆØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©.");
}

function logSeal(msg) {
    const grid = document.getElementById('sealReports');
    const card = document.createElement('div');
    card.className = 'report-card';
    card.innerHTML = `<i class="fas fa-shield-check"></i> <b>Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø®ØªÙ…:</b><br>${msg}`;
    grid.prepend(card);
}

function logForensic(msg, color='var(--nexa-red)') {
    const log = document.getElementById('forensicLog');
    log.innerHTML = `<span style="color:${color}">> ${msg}</span><br>` + log.innerHTML;
}

async function processNexaFiles(input) {
    if(!wallet) return alert("Ø§Ø±Ø¨Ø· Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø£ÙˆÙ„Ø§Ù‹");
    const files = Array.from(input.files);

    for (const f of files) {
        const reader = new FileReader();
        reader.onload = async (e) => {
            const hash = CryptoJS.SHA256(CryptoJS.lib.WordArray.create(e.target.result)).toString();
            
            // ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ù„Ù Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹
            const isSaved = registry.find(item => item.hash === hash);
            
            if (isSaved) {
                logForensic(`âš ï¸ Ø§Ù„Ù…Ù„Ù [${f.name}] Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ø¨ØªÙ‚Ù†ÙŠØ© nxa!`, 'var(--nexa-gold)');
                updateTable(f.name, hash, "Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹", "status-saved");
            } else {
                // ØªÙ†ÙÙŠØ° Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø®ØªÙ…
                logSeal(`Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ÙÙŠØ± Ø§Ù„Ø¬Ø²ÙŠØ¦ÙŠ Ù„Ù€ ${f.name}`);
                logSeal(`Ø­Ù‚Ù† ØªÙˆÙ‚ÙŠØ¹ MetaMask: ${wallet.substring(0,10)}...`);
                logSeal(`ØªÙ… Ø§Ù„Ø®ØªÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¨ØªÙ‚Ù†ÙŠØ© nxa Ø¨Ù†Ø¬Ø§Ø­.`);
                
                registry.push({ name: f.name, hash: hash });
                updateTable(f.name, hash, "Ù…Ø­ÙÙˆØ¸ Ø¨ØªÙ‚Ù†ÙŠØ© nxa", "status-saved");
            }
        };
        reader.readAsArrayBuffer(f);
    }
}

function updateTable(name, hash, status, badgeClass) {
    const row = `
        <tr>
            <td><b>${name}</b></td>
            <td style="font-family:monospace; font-size:0.6rem;">${hash.substring(0,32)}...</td>
            <td><span class="status-badge ${badgeClass}">${status}</span></td>
            <td><small>ØªÙ‚Ø±ÙŠØ± Ø±Ø§Ø¯Ø§Ø± NEXA Ø¬Ø§Ù‡Ø²</small></td>
        </tr>
    `;
    document.getElementById('registryTable').innerHTML = row + document.getElementById('registryTable').innerHTML;
}

async function runRadarCheck() {
    logForensic("ğŸ“¡ Ø§Ù„Ø±Ø§Ø¯Ø§Ø± ÙŠÙ…Ø³Ø­ Ø§Ù„Ù…Ù†ØµØ§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© Ø§Ù„Ø¢Ù†...");
    const input = document.createElement('input');
    input.type = 'file';
    input.onchange = (e) => {
        const file = e.target.files[0];
        const fr = new FileReader();
        fr.onload = (ev) => {
            const currentHash = CryptoJS.SHA256(CryptoJS.lib.WordArray.create(ev.target.result)).toString();
            const original = registry.find(r => r.name === file.name);

            if(original && currentHash !== original.hash) {
                logForensic(`ğŸš¨ Ø¥Ù†Ø°Ø§Ø± ØªÙ„Ø§Ø¹Ø¨! Ù…Ø­ØªÙˆÙ‰ [${file.name}] ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ø£ØµÙ„ Ø§Ù„Ù…Ø®ØªÙˆÙ….`);
                document.getElementById('radar').style.background = "conic-gradient(from 0deg, transparent, rgba(255,0,0,0.8))";
            } else if (original) {
                logForensic(`âœ… ØªØ·Ø§Ø¨Ù‚ ÙƒØ§Ù…Ù„ Ù„Ù€ [${file.name}]. Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø³Ù„ÙŠÙ….`, 'var(--nexa-green)');
            } else {
                logForensic(`â“ Ù…Ù„Ù [${file.name}] ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø³ÙŠØ§Ø¯ÙŠ.`);
            }
        };
        fr.readAsArrayBuffer(file);
    };
    input.click();
}
</script>
</body>
</html>
